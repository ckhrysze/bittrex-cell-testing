<!DOCTYPE html>
<html>
  <head>
    <title>Bittrex API with Cell.js</title>
    <script src="https://www.celljs.org/cell.js"></script>
  </head>
  <body>
    <table style="margin: 20px;">
      <thead id="header"></thead>
      <tbody id='bittrex'></tbody>
    </table>

    <script>
    const renderComponent = (type, text) => ({ $type: type, $text: text })
    const responseHeaders = ["MarketName", "Volume", "Bid", "OpenBuyOrders", "Created"]

    var header = {
      $cell: true,
      id: "header",
      $type: "thead",
      $components: responseHeaders.map(h => renderComponent('th', h)),
    }

    var bittrexData = {
      $cell: true,
      id: "bittrex",
      $type: "tbody",
      $init: function() { this._bittrex() },
      $update: function() { this.$components = this._items.map(this._template) },
      _items: [],
      _bittrex: function() {
        fetch("https://bittrex.com/api/v1.1/public/getmarketsummaries")
          .then(res => res.json())
          .then(obj => obj.result)
          .then(data => this._refresh(data))
      },
      _refresh: function(result) { this._items = result },
      _template: function(item) {
        return {
          $type: "tr",
          $components: responseHeaders.map(h => renderComponent('td', item[h])),
        }
      },
    }
    </script>
  </body>
</html>
